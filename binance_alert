# â€œâ€â€
å¹£å®‰ 5 åˆ†é˜æ¼²å¹…ç›£æ§ï¼ˆç¾è²¨ + åˆç´„ï¼‰+ Telegram é€šçŸ¥

éƒ¨ç½²å¹³å°ï¼šRailway.appï¼ˆå…è²»ï¼‰
æ‰‹æ©Ÿåªéœ€å®‰è£ Telegram å³å¯æ”¶åˆ°é€šçŸ¥ï¼

å–å¾— Telegram Bot Tokenï¼š
Telegram æœå°‹ @BotFather â†’ /newbot â†’ è¤‡è£½ Token

å–å¾— Chat IDï¼š
Telegram æœå°‹ @userinfobot â†’ ç™¼ä»»æ„è¨Šæ¯ â†’ è¤‡è£½ id æ•¸å­—
â€œâ€â€

import requests
import time
import logging
import os
from datetime import datetime

# ============================================================

# è¨­å®šï¼ˆRailway ä¸Šç”¨ç’°å¢ƒè®Šæ•¸ï¼Œæœ¬åœ°æ¸¬è©¦å¯ç›´æ¥å¡«ï¼‰

# ============================================================

TELEGRAM_BOT_TOKEN = os.environ.get(â€œTELEGRAM_BOT_TOKENâ€, â€œYOUR_BOT_TOKENâ€)
TELEGRAM_CHAT_ID   = os.environ.get(â€œTELEGRAM_CHAT_IDâ€,   â€œYOUR_CHAT_IDâ€)

ALERT_THRESHOLD  =  float(os.environ.get(â€œALERT_THRESHOLDâ€, â€œ3.0â€))   # æ¼²å¹…é–€æª» (%)
DROP_THRESHOLD   = -float(os.environ.get(â€œDROP_THRESHOLDâ€,  â€œ3.0â€))   # è·Œå¹…é–€æª» (%)
COOLDOWN_MINUTES =  int(os.environ.get(â€œCOOLDOWN_MINUTESâ€,  â€œ30â€))    # å†·å»æ™‚é–“ï¼ˆåˆ†é˜ï¼‰
CHECK_INTERVAL   =  int(os.environ.get(â€œCHECK_INTERVALâ€,    â€œ60â€))    # æƒæé–“éš”ï¼ˆç§’ï¼‰
KLINE_INTERVAL   =  os.environ.get(â€œKLINE_INTERVALâ€, â€œ5mâ€)            # Kç·šé€±æœŸ

MONITOR_SPOT     = True   # ç›£æ§ç¾è²¨
MONITOR_FUTURES  = True   # ç›£æ§åˆç´„

# ============================================================

SPOT_BASE    = â€œhttps://api.binance.comâ€
FUTURES_BASE = â€œhttps://fapi.binance.comâ€

logging.basicConfig(
level=logging.INFO,
format=â€%(asctime)s %(message)sâ€,
datefmt=â€%H:%M:%Sâ€
)
log = logging.getLogger(**name**)
alert_cooldown: dict = {}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# å–å¾—äº¤æ˜“å°åˆ—è¡¨

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

def get_spot_symbols() -> list:
resp = requests.get(fâ€{SPOT_BASE}/api/v3/exchangeInfoâ€, timeout=15)
resp.raise_for_status()
symbols = [
s[â€œsymbolâ€] for s in resp.json()[â€œsymbolsâ€]
if s[â€œquoteAssetâ€] == â€œUSDTâ€ and s[â€œstatusâ€] == â€œTRADINGâ€
]
log.info(fâ€[ç¾è²¨] å…± {len(symbols)} å€‹ USDT äº¤æ˜“å°â€)
return symbols

def get_futures_symbols() -> list:
resp = requests.get(fâ€{FUTURES_BASE}/fapi/v1/exchangeInfoâ€, timeout=15)
resp.raise_for_status()
symbols = [
s[â€œsymbolâ€] for s in resp.json()[â€œsymbolsâ€]
if s[â€œquoteAssetâ€] == â€œUSDTâ€
and s[â€œstatusâ€] == â€œTRADINGâ€
and s[â€œcontractTypeâ€] == â€œPERPETUALâ€
]
log.info(fâ€[åˆç´„] å…± {len(symbols)} å€‹ USDT æ°¸çºŒåˆç´„â€)
return symbols

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# å–å¾— K ç·šæ¼²å¹…

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

def get_kline_change(base_url: str, path: str, symbol: str):
try:
resp = requests.get(
fâ€{base_url}{path}â€,
params={â€œsymbolâ€: symbol, â€œintervalâ€: KLINE_INTERVAL, â€œlimitâ€: 2},
timeout=5
)
resp.raise_for_status()
kline = resp.json()[-2]   # å·²æ”¶ç›¤çš„ K ç·š
o = float(kline[1])
c = float(kline[4])
if o == 0:
return None
return round((c - o) / o * 100, 2)
except Exception:
return None

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# Telegram é€šçŸ¥

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

def send_telegram(message: str):
try:
resp = requests.post(
fâ€https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessageâ€,
json={â€œchat_idâ€: TELEGRAM_CHAT_ID, â€œtextâ€: message, â€œparse_modeâ€: â€œHTMLâ€},
timeout=10
)
if resp.status_code != 200:
log.warning(fâ€Telegram ç™¼é€å¤±æ•—: {resp.text}â€)
except Exception as e:
log.warning(fâ€Telegram éŒ¯èª¤: {e}â€)

def format_alert(market: str, symbol: str, change: float) -> str:
icon = â€œğŸš€â€ if change > 0 else â€œğŸ”»â€
tag  = â€œç¾è²¨â€ if market == â€œspotâ€ else â€œåˆç´„â€
sign = â€œ+â€ if change > 0 else â€œâ€
now  = datetime.now().strftime(â€%H:%M:%Sâ€)
return (
fâ€{icon}ã€{tag}ã€‘<b>{symbol}</b>\nâ€
fâ€ğŸ“Š {KLINE_INTERVAL} æ¼²å¹…ï¼š<b>{sign}{change}%</b>\nâ€
fâ€ğŸ• {now}â€
)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# å†·å»æ©Ÿåˆ¶

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

def is_in_cooldown(key: str) -> bool:
return key in alert_cooldown and (time.time() - alert_cooldown[key]) < COOLDOWN_MINUTES * 60

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# æƒæå¸‚å ´

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

def scan_market(market: str, base_url: str, path: str, symbols: list) -> int:
triggered = []
for symbol in symbols:
change = get_kline_change(base_url, path, symbol)
if change is None:
continue
key = fâ€{market}:{symbol}â€
if (change >= ALERT_THRESHOLD or change <= DROP_THRESHOLD) and not is_in_cooldown(key):
triggered.append((symbol, change))
alert_cooldown[key] = time.time()
time.sleep(0.05)

```
triggered.sort(key=lambda x: abs(x[1]), reverse=True)
for symbol, change in triggered:
    log.info(f"[{market}] {symbol} {change:+.2f}%")
    send_telegram(format_alert(market, symbol, change))

return len(triggered)
```

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# ä¸»ç¨‹å¼

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

def main():
if â€œYOUR_â€ in TELEGRAM_BOT_TOKEN or â€œYOUR_â€ in TELEGRAM_CHAT_ID:
print(â€œâŒ è«‹å…ˆè¨­å®š TELEGRAM_BOT_TOKEN å’Œ TELEGRAM_CHAT_IDï¼â€)
return

```
log.info("=" * 45)
log.info(f"å¹£å®‰æ¼²å¹…ç›£æ§å•Ÿå‹• | é€±æœŸï¼š{KLINE_INTERVAL}")
log.info(f"é–€æª»ï¼šæ¼² +{ALERT_THRESHOLD}% / è·Œ {DROP_THRESHOLD}%")
log.info(f"å†·å»ï¼š{COOLDOWN_MINUTES} åˆ†é˜ | æƒæï¼šæ¯ {CHECK_INTERVAL} ç§’")
log.info("=" * 45)

send_telegram(
    f"âœ… <b>å¹£å®‰æ¼²å¹…ç›£æ§å·²å•Ÿå‹•</b>\n"
    f"ğŸ“ˆ ç¾è²¨ + åˆç´„\n"
    f"âš¡ é–€æª»ï¼šæ¼² +{ALERT_THRESHOLD}% / è·Œ {abs(DROP_THRESHOLD)}%\n"
    f"â± Kç·šé€±æœŸï¼š{KLINE_INTERVAL}"
)

# å–å¾—äº¤æ˜“å°åˆ—è¡¨ï¼ˆåªåœ¨å•Ÿå‹•æ™‚å–ä¸€æ¬¡ï¼Œæ¯å°æ™‚æ›´æ–°ï¼‰
spot_symbols    = get_spot_symbols()    if MONITOR_SPOT    else []
futures_symbols = get_futures_symbols() if MONITOR_FUTURES else []
last_refresh    = time.time()

while True:
    # æ¯å°æ™‚é‡æ–°å–å¾—æœ€æ–°äº¤æ˜“å°åˆ—è¡¨
    if time.time() - last_refresh > 3600:
        spot_symbols    = get_spot_symbols()    if MONITOR_SPOT    else []
        futures_symbols = get_futures_symbols() if MONITOR_FUTURES else []
        last_refresh    = time.time()

    log.info(f"é–‹å§‹æƒæ...")

    total = 0
    if MONITOR_SPOT:
        total += scan_market("spot",    SPOT_BASE,    "/api/v3/klines",   spot_symbols)
    if MONITOR_FUTURES:
        total += scan_market("futures", FUTURES_BASE, "/fapi/v1/klines",  futures_symbols)

    log.info(f"æƒæå®Œæˆï¼Œå…±è§¸ç™¼ {total} å€‹é€šçŸ¥ã€‚ç­‰å¾… {CHECK_INTERVAL} ç§’...")
    time.sleep(CHECK_INTERVAL)
```

if **name** == â€œ**main**â€:
main()
